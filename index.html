<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voyage — Co-founding the Future</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script type="module" crossorigin src="./index-BEfEoJVR.js"></script>
    <link rel="stylesheet" crossorigin href="./index-DGJEfosU.css">
  </head>

  <body>
    <div id="root"></div>

    <script>
      (function () {
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/xbddgpby";

        const SUBMIT_RE = /(submit application|submit|apply|send|contact|join|提交|申请|发送)/i;

        function isVisible(el) {
          if (!el) return false;
          const style = window.getComputedStyle(el);
          if (style.display === "none" || style.visibility === "hidden" || style.opacity === "0") return false;
          const rects = el.getClientRects();
          return rects && rects.length > 0;
        }

        function cleanKey(s) {
          return (s || "")
            .toString()
            .trim()
            .replace(/\s+/g, " ")
            .replace(/[^\w\u4e00-\u9fa5 .:/()-]/g, "");
        }

        function findLabelText(el) {
          // 1) label[for=id]
          if (el.id) {
            const lab = document.querySelector(`label[for="${CSS.escape(el.id)}"]`);
            const t = cleanKey(lab && lab.innerText);
            if (t) return t;
          }
          // 2) closest label
          const near = el.closest && el.closest("label");
          const t2 = cleanKey(near && near.innerText);
          if (t2) return t2;

          // 3) try previous sibling text
          const prev = el.previousElementSibling;
          const t3 = cleanKey(prev && prev.innerText);
          if (t3) return t3;

          return "";
        }

        function guessKey(el, idx) {
          const name = cleanKey(el.getAttribute && el.getAttribute("name"));
          if (name) return name;

          const id = cleanKey(el.id);
          if (id) return id;

          const aria = cleanKey(el.getAttribute && el.getAttribute("aria-label"));
          if (aria) return aria;

          const ph = cleanKey(el.getAttribute && el.getAttribute("placeholder"));
          if (ph) return ph;

          const lab = findLabelText(el);
          if (lab) return lab;

          return `field_${idx + 1}`;
        }

        function collectVisibleFields(scopeEl) {
          const els = Array.from(scopeEl.querySelectorAll("input, textarea, select, [contenteditable='true']"))
            .filter(isVisible)
            .filter(el => !(el.tagName === "INPUT" && (el.type || "").toLowerCase() === "hidden"))
            .filter(el => !el.disabled);

          const fd = new FormData();
          let count = 0;

          els.forEach((el, idx) => {
            const tag = (el.tagName || "").toLowerCase();
            const type = ((el.getAttribute && el.getAttribute("type")) || "").toLowerCase();
            const key = guessKey(el, idx);

            if (!key) return;

            if (type === "file") {
              const files = el.files ? Array.from(el.files) : [];
              files.forEach(f => { fd.append(key, f); count++; });
              return;
            }

            if (type === "radio") {
              if (el.checked) { fd.append(key, el.value || "on"); count++; }
              return;
            }

            if (type === "checkbox") {
              fd.append(key, el.checked ? (el.value || "yes") : "no");
              count++;
              return;
            }

            if (tag === "select") {
              // 发送 value + 文案更好排查
              const val = el.value ?? "";
              const text = (el.selectedOptions && el.selectedOptions[0] && el.selectedOptions[0].text) ? el.selectedOptions[0].text : "";
              fd.append(key, text ? `${val} (${text})` : val);
              count++;
              return;
            }

            if (el.getAttribute && el.getAttribute("contenteditable") === "true") {
              const v = cleanKey(el.innerText);
              if (v) { fd.append(key, v); count++; }
              return;
            }

            fd.append(key, el.value ?? "");
            count++;
          });

          return { fd, count };
        }

        function findSubmitCandidate(startEl) {
          // 从点击点向上找 12 层，任何标签只要文本匹配就算
          let el = startEl;
          for (let i = 0; i < 12 && el; i++) {
            const txt = ((el.innerText || el.value || "") + "").trim();
            const aria = el.getAttribute ? (el.getAttribute("aria-label") || "") : "";
            if (SUBMIT_RE.test(txt) || SUBMIT_RE.test(aria)) return el;
            el = el.parentElement;
          }
          return null;
        }

        async function post(fd) {
          return fetch(FORMSPREE_ENDPOINT, {
            method: "POST",
            body: fd,
            headers: { "Accept": "application/json" },
          });
        }

        function debugPrint(fd) {
          console.log("[Formspree] payload entries:");
          let n = 0;
          for (const [k, v] of fd.entries()) {
            console.log(" -", k, v);
            n++;
          }
          console.log("[Formspree] total entries:", n);
        }

        window.addEventListener("DOMContentLoaded", () => {
          document.addEventListener("click", async (e) => {
            const candidate = findSubmitCandidate(e.target);
            if (!candidate) return;

            // 关键：确认我们真的抓到了按钮
            console.log("[Formspree] submit-like click detected on:", candidate);

            e.preventDefault();
            e.stopPropagation();

            // 尽量缩小范围：优先找“弹窗/表单卡片”，找不到就整个 document
            const scope =
              candidate.closest("[role='dialog']") ||
              candidate.closest("section") ||
              candidate.closest("main") ||
              candidate.closest("div") ||
              document;

            const { fd, count } = collectVisibleFields(scope);

            fd.append("_page", location.href);
            fd.append("_ts", new Date().toISOString());

            debugPrint(fd);

            // 如果字段仍然 0，说明你的输入不是标准 input/textarea/select（或都不可见）
            if (count === 0) {
              alert("No form fields detected. Please send me an Inspect screenshot of one input element.");
              return;
            }

            try {
              candidate.disabled = true; // 对 button 有效；div 无影响但不报错
              const res = await post(fd);

              if (res.ok) {
                alert("Submitted! We’ll get back to you soon.");
              } else {
                const body = await res.json().catch(() => null);
                console.error("[Formspree] error:", res.status, body);
                alert("Submit failed. Open DevTools → Network to see details.");
              }
            } catch (err) {
              console.error(err);
              alert("Submit failed. Please try again.");
            } finally {
              try { candidate.disabled = false; } catch (_) {}
            }
          }, true);
        });
      })();
    </script>
  </body>
</html>
