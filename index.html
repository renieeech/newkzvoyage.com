<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voyage — Co-founding the Future</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script type="module" crossorigin src="./index-BEfEoJVR.js"></script>
    <link rel="stylesheet" crossorigin href="./index-DGJEfosU.css">
  </head>

  <body>
    <div id="root"></div>

<script>
(function () {
  const ENDPOINT = "https://formspree.io/f/xbddgpby";
  const SUBMIT_TEXT_RE = /^(submit application|提交申请|submit|apply|提交|申请|发送)$/i;

  // ✅ 全局防抖锁：一次提交未结束前，禁止第二次
  let submitting = false;
  let lastSubmitAt = 0;
  const COOLDOWN_MS = 4000; // 4秒内重复点击直接忽略

  function clean(s){ return (s||"").toString().trim().replace(/\s+/g," "); }
  function isVisible(el){
    if(!el) return false;
    const st = getComputedStyle(el);
    if(st.display==="none" || st.visibility==="hidden" || st.opacity==="0") return false;
    return el.getClientRects().length>0;
  }

  function findSubmitEl(from){
    let el = from;
    for(let i=0;i<16 && el;i++){
      const txt = clean(el.innerText || el.value || "");
      const aria = clean(el.getAttribute ? el.getAttribute("aria-label") : "");
      // ✅ 必须“完全匹配”按钮文字，避免点到容器也触发
      if(txt && SUBMIT_TEXT_RE.test(txt)) return el;
      if(aria && SUBMIT_TEXT_RE.test(aria)) return el;
      el = el.parentElement;
    }
    return null;
  }

  function keyFor(el, idx){
    const n = clean(el.getAttribute && el.getAttribute("name"));
    const id = clean(el.id);
    const aria = clean(el.getAttribute && el.getAttribute("aria-label"));
    const ph = clean(el.getAttribute && el.getAttribute("placeholder"));
    return n || id || aria || ph || `field_${idx+1}`;
  }

  function collect(scope){
    const els = Array.from(scope.querySelectorAll("input, textarea, select, [contenteditable='true']"))
      .filter(isVisible)
      .filter(el => !(el.tagName==="INPUT" && (el.type||"").toLowerCase()==="hidden"))
      .filter(el => !el.disabled);

    const out = {};
    els.forEach((el, idx) => {
      const key = keyFor(el, idx);
      const tag = (el.tagName||"").toLowerCase();
      const type = ((el.getAttribute && el.getAttribute("type"))||"").toLowerCase();

      if(type==="radio"){ if(el.checked) out[key] = el.value || "on"; return; }
      if(type==="checkbox"){ out[key] = el.checked ? (el.value||"yes") : "no"; return; }
      if(tag==="select"){ out[key] = el.value ?? ""; return; }
      if(el.getAttribute && el.getAttribute("contenteditable")==="true"){ out[key] = clean(el.innerText); return; }
      out[key] = el.value ?? "";
    });

    return out;
  }

  // ✅ 只显示一个提示条（重复点击不再新增）
  function showMsg(anchor, ok, text){
    let box = anchor.__fsBox;
    if(!box){
      box = document.createElement("div");
      box.style.marginTop = "12px";
      box.style.padding = "10px 12px";
      box.style.borderRadius = "10px";
      box.style.fontSize = "14px";
      box.style.border = "1px solid rgba(255,255,255,0.15)";
      box.style.background = "rgba(0,0,0,0.35)";
      box.style.color = "#fff";
      anchor.parentElement && anchor.parentElement.appendChild(box);
      anchor.__fsBox = box;
    }
    box.style.borderColor = ok ? "rgba(34,197,94,0.6)" : "rgba(239,68,68,0.6)";
    box.style.background = ok ? "rgba(34,197,94,0.12)" : "rgba(239,68,68,0.12)";
    box.textContent = text;
  }

  async function post(payload){
    const controller = new AbortController();
    const t = setTimeout(() => controller.abort(), 12000);
    try{
      return await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Accept":"application/json", "Content-Type":"application/json" },
        body: JSON.stringify(payload),
        signal: controller.signal
      });
    } finally {
      clearTimeout(t);
    }
  }

  // ✅ 捕获阶段拦截，且阻断 React 自己的提交
  document.addEventListener("click", async (e) => {
    const submitEl = findSubmitEl(e.target);
    if(!submitEl) return;

    // 防止一次点击冒泡/组合事件触发多次：只处理“第一次”
    if (e.detail && e.detail > 1) return; // 双击/连点
    const now = Date.now();
    if (submitting) return;
    if (now - lastSubmitAt < COOLDOWN_MS) return;

    // 强制阻断页面原逻辑
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();

    submitting = true;
    lastSubmitAt = now;

    const scope =
      submitEl.closest("[role='dialog']") ||
      submitEl.closest("section") ||
      submitEl.closest("main") ||
      submitEl.closest("div") ||
      document;

    const fields = collect(scope);

    // 给 formspree 一个 message 便于阅读
    const message = Object.entries(fields).map(([k,v]) => `${k}: ${v}`).join("\n");

    // ✅ 加一个本地“幂等ID”，你在 Formspree 里可用来识别重复（必要时也可过滤）
    const submission_id = `${Date.now()}-${Math.random().toString(16).slice(2)}`;

    const payload = {
      ...fields,
      message,
      submission_id,
      _page: location.href,
      _ts: new Date().toISOString(),
      _subject: "New Co-founder Application"
    };

    showMsg(submitEl, true, "Submitting to Formspree…");

    try{
      submitEl.style.pointerEvents = "none";

      const res = await post(payload);
      if(res.ok){
        showMsg(submitEl, true, "✅ Submitted successfully!");
      } else {
        const body = await res.json().catch(()=>null);
        console.error("[Formspree] error:", res.status, body);
        showMsg(submitEl, false, `❌ Submit failed (${res.status}).`);
      }
    } catch (err) {
      console.error(err);
      const msg = (err && err.name==="AbortError")
        ? "❌ Submit timed out (12s). Please try again."
        : "❌ Submit failed. Please try again.";
      showMsg(submitEl, false, msg);
    } finally {
      submitEl.style.pointerEvents = "";
      submitting = false;
      // 冷却结束后允许再次提交（避免用户疯狂点）
      setTimeout(() => { /* no-op, cooldown handled by lastSubmitAt */ }, COOLDOWN_MS);
    }
  }, true);
})();
</script>
  </body>
</html>
