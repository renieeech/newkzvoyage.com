<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voyage — Co-founding the Future</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script type="module" crossorigin src="./index-BEfEoJVR.js"></script>
    <link rel="stylesheet" crossorigin href="./index-DGJEfosU.css">

    <script>
      (function () {
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/xbddgpby";

        function isSubmitLikeButton(btn) {
          const text = ((btn.innerText || btn.value || "") + "").trim().toLowerCase();
          return /(submit|apply|send|contact|join|提交|申请|发送)/i.test(text);
        }

        function cleanKey(s) {
          return (s || "")
            .toString()
            .trim()
            .replace(/\s+/g, " ")
            .replace(/[^\w\u4e00-\u9fa5 .:/()-]/g, "");
        }

        function guessFieldKey(el, idx) {
          // 1) name / id
          const name = cleanKey(el.getAttribute("name"));
          if (name) return name;

          const id = cleanKey(el.id);
          if (id) return id;

          // 2) aria-label / placeholder
          const aria = cleanKey(el.getAttribute("aria-label"));
          if (aria) return aria;

          const ph = cleanKey(el.getAttribute("placeholder"));
          if (ph) return ph;

          // 3) <label for="..."> 或者 最近的 label 文本
          if (el.id) {
            const lab = document.querySelector(`label[for="${CSS.escape(el.id)}"]`);
            const t = cleanKey(lab && lab.innerText);
            if (t) return t;
          }
          const nearestLabel = el.closest("label");
          const t2 = cleanKey(nearestLabel && nearestLabel.innerText);
          if (t2) return t2;

          // 4) 兜底：按顺序编号
          return `field_${idx + 1}`;
        }

        function getContentEditableValue(el) {
          return cleanKey(el.innerText);
        }

        function collectFields(container) {
          // 标准表单元素
          const inputs = Array.from(container.querySelectorAll("input, textarea, select"));
          // 有些 UI 组件用 contenteditable div 作为输入
          const editables = Array.from(container.querySelectorAll("[contenteditable='true']"));

          const fd = new FormData();

          // 收集 input/textarea/select
          inputs.forEach((el, idx) => {
            const tag = (el.tagName || "").toLowerCase();
            const type = ((el.getAttribute("type") || "") + "").toLowerCase();

            const key = guessFieldKey(el, idx);
            if (!key) return;

            if (type === "file") {
              const files = el.files ? Array.from(el.files) : [];
              files.forEach((f) => fd.append(key, f));
              return;
            }

            if (type === "radio") {
              if (el.checked) fd.append(key, el.value || "on");
              return;
            }

            if (type === "checkbox") {
              fd.append(key, el.checked ? (el.value || "yes") : "no");
              return;
            }

            if (tag === "select") {
              fd.append(key, el.value ?? "");
              return;
            }

            fd.append(key, el.value ?? "");
          });

          // 收集 contenteditable（如果有）
          editables.forEach((el, idx) => {
            const key = guessFieldKey(el, inputs.length + idx);
            const val = getContentEditableValue(el);
            if (val) fd.append(key, val);
          });

          return fd;
        }

        async function postToFormspree(fd) {
          return fetch(FORMSPREE_ENDPOINT, {
            method: "POST",
            body: fd,
            headers: { "Accept": "application/json" },
          });
        }

        document.addEventListener("click", async (e) => {
          const btn = e.target.closest("button, input[type='submit'], input[type='button']");
          if (!btn) return;
          if (!isSubmitLikeButton(btn)) return;

          e.preventDefault();
          e.stopPropagation();

          const form = btn.closest("form");
          const container =
            form ||
            btn.closest("[role='dialog']") ||
            btn.closest("section") ||
            btn.closest("main") ||
            btn.closest("div") ||
            document;

          // 如果有 form，优先用它；否则用我们的智能收集
          const fd = form ? new FormData(form) : collectFields(container);

          // 永远附加这些，方便你在 Formspree 邮件里定位来源
          fd.append("_page", location.href);
          fd.append("_ts", new Date().toISOString());

          // Debug：你可以在控制台看到到底收集到了哪些字段
          try {
            console.log("[Formspree] collected:");
            for (const [k, v] of fd.entries()) console.log(" -", k, v);
          } catch (_) {}

          try {
            btn.disabled = true;
            const res = await postToFormspree(fd);

            if (res.ok) {
              alert("Submitted! We’ll get back to you soon.");
              if (form) form.reset();
            } else {
              const body = await res.json().catch(() => null);
              console.error("Formspree error:", res.status, body);
              alert("Submit failed. Please try again.");
            }
          } catch (err) {
            console.error(err);
            alert("Submit failed. Please try again.");
          } finally {
            btn.disabled = false;
          }
        }, true);
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
  </body>
</html>
